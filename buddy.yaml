- pipeline: "Userbot"
  on: "EVENT"
  events:
  - type: "PUSH"
    refs:
    - "refs/heads/main"
  priority: "NORMAL"
  fail_on_prepare_env_warning: true
  actions:
  - action: "Deploy"
    type: "BUILD"
    working_directory: "/buddy/bot-deploy"
    docker_image_name: "library/ubuntu"
    docker_image_tag: "22.10"
    execute_commands:
    - "export DEBIAN_FRONTEND=noninteractive"
    - "export TZ=Asia/Jakarta"
    - "ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone"
    - "apt-get update && apt-get upgrade -y"
    - "apt-get install tzdata apt-utils git python3.10 python3-pip curl tmux screen  wget tree wget2 p7zip-full jq ffmpeg wget neofetch nodejs npm libxslt-dev bash build-essential curl ffmpeg figlet gfortran gnupg2 jq liblapack-dev libopenblas-dev libpq-dev libssl-dev libxml2-dev libxml2 postgresql pv sudo unar unzip wkhtmltopdf wget xz-utils zip ca-certificates netbase dpkg-dev gcc gnupg dirmngr libbluetooth-dev libbz2-dev libc6-dev libexpat1-dev libffi-dev libgdbm-dev liblzma-dev libncursesw5-dev libreadline-dev libsqlite3-dev libssl-dev make tk-dev uuid-dev wget xz-utils zlib1g-dev -y"
    - "apt-mark hold tzdata && ln -snf /usr/share/zoneinfo/Asia/Jakarta /etc/localtime && echo Asia/Jakarta > /etc/timezone"
    - "wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb"
    - "apt-get -y install ./google-chrome-stable_current_amd64.deb"
    - "rm -rf google-chrome-stable_current_amd64.deb"
    - "python3 -m pip install --upgrade pip"
    - "git config --global user.email jarbull86@gmail.com"
    - "git config --global user.name NFS86"
    - "git clone https://NFS86:$GH_TOKEN@github.com/NFS86/NFS-Userbot -b NFS-Userbot"
    - "cd NFS-Userbot"
    - "pip3 install -r requirements.txt"
    - "curl $CONFIG_FILE_URL -o config.env"
    - "bash start &"
    - "sleep 70m"
    - "cd"
    - "rm -rf NFS-Userbot && rm -rfd NFS-Userbot"
    - "git clone https://NFS86:$GH_TOKEN@github.com/NFS-projects/bot-deploy"
    - "cd bot-deploy"
    - "git fetch origin && git merge FETCH_HEAD"
    - "git commit --allow-empty -m \"Bot Deploy | $(/bin/date)\""
    - "git push"
    - "cd"
    - "rm -rf bot-deploy && rm -rfd bot-deploy"
    volume_mappings:
    - "/:/buddy/bot-deploy"
    cache_base_image: true
    shell: "BASH"
    variables:
    - key: "CONFIG_FILE_URL"
      value: "secure!8FaoS7oSxdvdJ3m0USp7wXhmJ7FZSsTsNE3RQH5N8gqTZ/Fz2MynRizZqrUCjqG7eof/w9Fw01zwhGvDBKSdNGNqReT1/6X2kKby2gBtbkSjUgUF75gDm2lzBqJrB7JS.u+NarsQ5pg9qnUNwv4XYRw=="
      type: "VAR"
      encrypted: true
    - key: "GH_TOKEN"
      value: "secure!iY14Y24ImjF4gVQB+zwxEijzCBysMBWrvWyeeCX70Tonsa9av8ViFObYrNmLCBI8.qGuNdZAytO+cZTxoyn1cTw=="
      type: "VAR"
      encrypted: true
